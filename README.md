# Library REST API

## 1. База данных

База данных PostgreSQL разворачивается в докере, для этого достаточно запустить `init_env.ps1` или содержащийся в нем
скрипт `docker-compose up -d` напрямую.

Информацию для подключения можно найти в `docker-compose.yml`.

### 1.1. Миграции

- Миграции реализованы с помощью библиотеки `FluentMigrator`.
- Миграции описываются в классах в папке `Migrations`.
- По умолчанию применяются все миграции.
- Откатить миграции можно заменив `MigrateUp` на `MigrateDown` в `Program.cs`.

## 2. Запуск проекта

Самый простой способ (кажется) - скачать Jetbrains Rider и запустить с его помощью.

Альтернативный путь - попытаться сбилдить проект с помощью `dotnet build`. Здесь (предполагаю) могут возникнуть проблемы
с наличием нужных компонентов .NET. В этом случае билд должен появиться в `LibraryApi\bin\Debug\net5.0`.

## 3. Функционал

Реализованы:

- CRUD ручки для сущностей `book`, `book_copy`, `reader`;
- Ручки Search и Create для сущности `borrowing`. Search чуть менее примитивная: принимая на вход ID читателя, ISBN и
  диапазон времени, она возвращает записи `borrowing`, расширенные информацией о книге и читателе. Любой элемент фильтра
  можно опустить.
- Генераторы фейковых данных для каждой сущности. Стоит учесть, что для генерации копий книг необходимо наличие хоть
  каких-то книг, а для генерации `borrowing` необходимы читатели и копии книг. Их стоит сгенерировать заранее.

## 4. Структура проекта

Проект выполнен в некотором подобии трёхслойной архитектуры. По папкам:

- `Controllers`: REST контроллеры;
- `Services`: сервисы ("логика");
- `DataAccess/Repositories`: запросы к БД;
- `Domain`: модели, DTO, а также интерфейсы сервисов и репозиториев (Separated Interface);

## Используемые библиотеки

- `Npgsql` - подключение к базе PostgreSQL;
- `Dapper` - micro-orm для отображения сущностей базы в объекты;
- `FluentMigrator` - миграции БД;
- `Faker.Net` - генерация фейковых данных;
- `Newtonsoft.Json` - json сериализация;
